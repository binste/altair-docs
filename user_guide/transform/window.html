
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Window Transform &#8212; Altair 5.0.0 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/altair-plot.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/altair-gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/transform/window';</script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Interactive Charts: Parameters, Conditions, Bindings" href="../interactions.html" />
    <link rel="prev" title="TimeUnit Transform" href="timeunit.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    <a class="navbar-brand" href="../../index.html">
<p class="title">Altair</p>
</a>

    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../../getting_started/overview.html">
                        Getting Started
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="../data.html">
                        User Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../gallery/index.html">
                        Examples
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../API.html">
                        Reference
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../ecosystem.html">
                        Ecosystem
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                    <a class="nav-link" href="../../releases/changes.html">
                        Release Notes
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../getting_help.html">
                        Help
                    </a>
                </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../../getting_started/overview.html">
                        Getting Started
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="../data.html">
                        User Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../gallery/index.html">
                        Examples
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../API.html">
                        Reference
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../ecosystem.html">
                        Ecosystem
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                    <a class="nav-link" href="../../releases/changes.html">
                        Release Notes
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../getting_help.html">
                        Help
                    </a>
                </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/altair-logo-light.png" class="logo" alt="logo">
      <br>
      <p class="site-version" id="site-version">5.0.0</p>
      
    </a>
</div>
    </div>
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../data.html">Specifying Data in Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../encoding.html">Encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../marks.html">Marks</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Data Transformations</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="aggregate.html">Aggregate Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="bin.html">Bin transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="calculate.html">Calculate Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="density.html">Density Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter.html">Filter Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="flatten.html">Flatten Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="fold.html">Fold Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="impute.html">Impute Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="joinaggregate.html">Join Aggregate Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="lookup.html">Lookup Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="loess.html">LOESS Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="pivot.html">Pivot Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="quantile.html">Quantile Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="regression.html">Regression Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample.html">Sample Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="stack.html">Stack Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeunit.html">TimeUnit Transform</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Window Transform</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interactions.html">Interactive Charts: Parameters, Conditions, Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compound_charts.html">Compound Charts: Layer, HConcat, VConcat, Repeat, Facet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scale_resolve.html">Scale and Guide Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../times_and_dates.html">Times and Dates in Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customization.html">Customizing Visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Top-Level Chart Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../saving_charts.html">Saving Altair Charts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Usage</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../internals.html">Altair Internals: Understanding the Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../importing.html">Importing Vega &amp; Vega-Lite Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../display_frontends.html">Displaying Altair Charts</a></li>

<li class="toctree-l1"><a class="reference internal" href="../custom_renderers.html">Customizing Renderers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_transformers.html">Data transformers</a></li>
</ul>

  </div>
</nav>
    </div>
    <div class="sidebar-start-items__item">
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="window-transform">
<span id="user-guide-window-transform"></span><h1>Window Transform<a class="headerlink" href="#window-transform" title="Permalink to this heading">#</a></h1>
<p>The window transform performs calculations over sorted groups of data objects.
These calculations include ranking, lead/lag analysis, and aggregates such as cumulative sums and averages.
Calculated values are written back to the input data stream, where they can be referenced by encodings.</p>
<p>For example, consider the following cumulative frequency distribution:</p>
<div class="highlight-python notranslate" id="window-rst-altair-source-0"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
    <span class="n">sort</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;IMDB_Rating&#39;</span><span class="p">}],</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">cumulative_count</span><span class="o">=</span><span class="s1">&#39;count(*)&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;IMDB_Rating:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;cumulative_count:Q&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="window-rst-altair-plot-0">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/movies.json"}, "mark": "area", "encoding": {"x": {"field": "IMDB_Rating", "type": "quantitative"}, "y": {"field": "cumulative_count", "type": "quantitative"}}, "transform": [{"window": [{"op": "count", "field": "*", "as": "cumulative_count"}], "frame": [null, 0], "sort": [{"field": "IMDB_Rating"}]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#window-rst-altair-plot-0', spec, opt).catch(console.err);
  });
</script>
</div><p>First, we pass a sort field definition, which indicates how data objects should be sorted within the window.
Here, movies should be sorted by their IMDB rating.
Next, we pass the frame, which indicates how many data objects before and after the current data object should be included within the window.
Here, all movies up to and including the current movie should be included.
Finally, we pass a window field definition, which indicates how data objects should be aggregated within the window.
Here, the number of movies should be counted.</p>
<p>There are many aggregation functions built into Altair.
As well as those given in <a class="reference internal" href="../encoding.html#encoding-aggregates"><span class="std std-ref">Binning and Aggregation</span></a>, we can use the following within window field definitions:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Aggregate</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>row_number</p></td>
<td><p>None</p></td>
<td><p>Assigns each data object a consecutive row number, starting from 1.</p></td>
</tr>
<tr class="row-odd"><td><p>rank</p></td>
<td><p>None</p></td>
<td><p>Assigns a rank order value to each data object in a window, starting from 1. Peer values are assigned the same rank. Subsequent rank scores incorporate the number of prior values. For example, if the first two values tie for rank 1, the third value is assigned rank 3.</p></td>
</tr>
<tr class="row-even"><td><p>dense_rank</p></td>
<td><p>None</p></td>
<td><p>Assigns dense rank order values to each data object in a window, starting from 1. Peer values are assigned the same rank. Subsequent rank scores do not incorporate the number of prior values. For example, if the first two values tie for rank 1, the third value is assigned rank 2.</p></td>
</tr>
<tr class="row-odd"><td><p>percent_rank</p></td>
<td><p>None</p></td>
<td><p>Assigns a percentage rank order value to each data object in a window. The percent is calculated as (rank - 1) / (group_size - 1).</p></td>
</tr>
<tr class="row-even"><td><p>cume_dist</p></td>
<td><p>None</p></td>
<td><p>Assigns a cumulative distribution value between 0 and 1 to each data object in a window.</p></td>
</tr>
<tr class="row-odd"><td><p>ntile</p></td>
<td><p>Number</p></td>
<td><p>Assigns a quantile (e.g., percentile) value to each data object in a window. Accepts an integer parameter indicating the number of buckets to use (e.g., 100 for percentiles, 5 for quintiles).</p></td>
</tr>
<tr class="row-even"><td><p>lag</p></td>
<td><p>Number</p></td>
<td><p>Assigns a value from the data object that precedes the current object by a specified number of positions. If no such object exists, assigns <code class="docutils literal notranslate"><span class="pre">null</span></code>. Accepts an offset parameter (default <code class="docutils literal notranslate"><span class="pre">1</span></code>) that indicates the number of positions. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</p></td>
</tr>
<tr class="row-odd"><td><p>lead</p></td>
<td><p>Number</p></td>
<td><p>Assigns a value from the data object that follows the current object by a specified number of positions. If no such object exists, assigns <code class="docutils literal notranslate"><span class="pre">null</span></code>. Accepts an offset parameter (default <code class="docutils literal notranslate"><span class="pre">1</span></code>) that indicates the number of positions. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</p></td>
</tr>
<tr class="row-even"><td><p>first_value</p></td>
<td><p>None</p></td>
<td><p>Assigns a value from the first data object in the current sliding window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</p></td>
</tr>
<tr class="row-odd"><td><p>last_value</p></td>
<td><p>None</p></td>
<td><p>Assigns a value from the last data object in the current sliding window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</p></td>
</tr>
<tr class="row-even"><td><p>nth_value</p></td>
<td><p>Number</p></td>
<td><p>Assigns a value from the nth data object in the current sliding window frame. If no such object exists, assigns <code class="docutils literal notranslate"><span class="pre">null</span></code>. Requires a non-negative integer parameter that indicates the offset from the start of the window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</p></td>
</tr>
</tbody>
</table>
<p>While an aggregate transform computes a single value that summarises all data objects, a window transform adds a new property to each data object.
This new property is computed from the neighbouring data objects: that is, from the data objects delimited by the window field definition.
For example, consider the following time series of stock prices:</p>
<div class="highlight-python notranslate" id="window-rst-altair-source-1"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">stocks</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;price:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;symbol:N&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="window-rst-altair-plot-1">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/stocks.csv"}, "mark": "line", "encoding": {"color": {"field": "symbol", "type": "nominal"}, "x": {"field": "date", "type": "temporal"}, "y": {"field": "price", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#window-rst-altair-plot-1', spec, opt).catch(console.err);
  });
</script>
</div><p>It’s hard to see the overall pattern in the above example, because Google’s stock price is much higher than the other stock prices.
If we plot the <a class="reference external" href="https://en.wikipedia.org/w/index.php?title=Z-score">z-scores</a> of the stock prices, rather than the stock prices themselves, then the overall pattern becomes clearer:</p>
<div class="highlight-python notranslate" id="window-rst-altair-source-2"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">stocks</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
    <span class="n">mean_price</span><span class="o">=</span><span class="s1">&#39;mean(price)&#39;</span><span class="p">,</span>
    <span class="n">stdev_price</span><span class="o">=</span><span class="s1">&#39;stdev(price)&#39;</span><span class="p">,</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">z_score</span><span class="o">=</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">price</span> <span class="o">-</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">mean_price</span><span class="p">)</span> <span class="o">/</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">stdev_price</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;z_score:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;symbol:N&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="window-rst-altair-plot-2">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/stocks.csv"}, "mark": "line", "encoding": {"color": {"field": "symbol", "type": "nominal"}, "x": {"field": "date", "type": "temporal"}, "y": {"field": "z_score", "type": "quantitative"}}, "transform": [{"window": [{"op": "mean", "field": "price", "as": "mean_price"}, {"op": "stdev", "field": "price", "as": "stdev_price"}], "frame": [null, null], "groupby": ["symbol"]}, {"calculate": "((datum.price - datum.mean_price) / datum.stdev_price)", "as": "z_score"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#window-rst-altair-plot-2', spec, opt).catch(console.err);
  });
</script>
</div><p>By using two aggregation functions (<code class="docutils literal notranslate"><span class="pre">mean</span></code> and <code class="docutils literal notranslate"><span class="pre">stdev</span></code>) within the window transform, we are able to compute the z-scores within the calculate transform.</p>
<p>For more information about the arguments to the window transform, see <a class="reference internal" href="../generated/core/altair.WindowTransform.html#altair.WindowTransform" title="altair.WindowTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">WindowTransform</span></code></a> and <a class="reference external" href="https://vega.github.io/vega-lite/docs/window.html">the Vega-Lite documentation</a>.</p>
<section id="transform-options">
<h2>Transform Options<a class="headerlink" href="#transform-options" title="Permalink to this heading">#</a></h2>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">transform_window()</span></code> method is built on the <a class="reference internal" href="../generated/core/altair.WindowTransform.html#altair.WindowTransform" title="altair.WindowTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">WindowTransform</span></code></a>
class, which has the following options:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="vl-prop"><p>frame</p></td>
<td><p>array([null, number])</p></td>
<td class="vl-decsr"><p>A frame specification as a two-element array indicating how the sliding window should proceed. The array entries should either be a number indicating the offset from the current data object, or null to indicate unbounded rows preceding or following the current data object. The default value is <code class="docutils literal notranslate"><span class="pre">[null,</span> <span class="pre">0]</span></code>, indicating that the sliding window includes the current object and all preceding objects. The value <code class="docutils literal notranslate"><span class="pre">[-5,</span> <span class="pre">5]</span></code> indicates that the window should include five objects preceding and five objects following the current object. Finally, <code class="docutils literal notranslate"><span class="pre">[null,</span> <span class="pre">null]</span></code> indicates that the window frame should always include all data objects. If you this frame and want to assign the same value to add objects, you can use the simpler <a class="reference external" href="https://vega.github.io/vega-lite/docs/joinaggregate.html">join aggregate transform</a>. The only operators affected are the aggregation operations and the <code class="docutils literal notranslate"><span class="pre">first_value</span></code>, <code class="docutils literal notranslate"><span class="pre">last_value</span></code>, and <code class="docutils literal notranslate"><span class="pre">nth_value</span></code> window operations. The other window operations are not affected by this.</p>
<p><strong>Default value:</strong>:  <code class="docutils literal notranslate"><span class="pre">[null,</span> <span class="pre">0]</span></code> (includes the current object and all preceding objects)</p>
</td>
</tr>
<tr class="row-odd"><td class="vl-prop"><p>groupby</p></td>
<td><p>array(<a class="reference internal" href="../generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal notranslate"><span class="pre">FieldName</span></code></a>)</p></td>
<td class="vl-decsr"><p>The data fields for partitioning the data objects into separate windows. If unspecified, all data points will be in a single window.</p></td>
</tr>
<tr class="row-even"><td class="vl-prop"><p>ignorePeers</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">boolean</span></code></p></td>
<td class="vl-decsr"><p>Indicates if the sliding window frame should ignore peer values (data that are considered identical by the sort criteria). The default is false, causing the window frame to expand to include all peer values. If set to true, the window frame will be defined by offset values only. This setting only affects those operations that depend on the window frame, namely aggregation operations and the first_value, last_value, and nth_value window operations.</p>
<p><strong>Default value:</strong> <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</td>
</tr>
<tr class="row-odd"><td class="vl-prop"><p>sort</p></td>
<td><p>array(<a class="reference internal" href="../generated/core/altair.SortField.html#altair.SortField" title="altair.SortField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SortField</span></code></a>)</p></td>
<td class="vl-decsr"><p>A sort field definition for sorting data objects within a window. If two data objects are considered equal by the comparator, they are considered “peer” values of equal rank. If sort is not specified, the order is undefined: data objects are processed in the order they are observed and none are considered peers (the ignorePeers parameter is ignored and treated as if set to <code class="docutils literal notranslate"><span class="pre">true</span></code>).</p></td>
</tr>
<tr class="row-even"><td class="vl-prop"><p>window</p></td>
<td><p>array(<a class="reference internal" href="../generated/core/altair.WindowFieldDef.html#altair.WindowFieldDef" title="altair.WindowFieldDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">WindowFieldDef</span></code></a>)</p></td>
<td class="vl-decsr"><p>The definition of the fields in the window, and what calculations to use.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="timeunit.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">TimeUnit Transform</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../interactions.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Interactive Charts: Parameters, Conditions, Bindings</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transform-options">
   Transform Options
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../../_sources/user_guide/transform/window.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2016-2022, Altair Developers.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>